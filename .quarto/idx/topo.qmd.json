{"title":"Fruit flies","markdown":{"yaml":{"format":{"revealjs":{"slide-number":true,"smaller":true,"scrollable":true,"theme":"default","footer":"Sex- and stage-structured SIT model - MPDEE 2023 Marseille","chalkboard":true,"css":"styles.scss"}},"execute":{"output":false,"echo":false,"freeze":"auto","cache":true},"jupyter":"julia-1.8","from":"markdown+emoji"},"headingText":"Fruit flies","containsRefs":false,"markdown":"\n\n\n<h2> A sex- and stage-structured model<br>for pest control using the sterile insect technique </h2>\n\n<br><br><br><br><br><br><br><br>\n<h4> C. Kounoudji, S. Touzeau^1,2^, F. Grognard^2^, L. van Oudenhove^1^, L. Mailleret^1,2\\*^ </h4>\n\n<hr>\n\n\n<p> 1: M2P2, ISA (INRAE, CNRS, Univ. Côte d'Azur)<br>\n     2: MACBES (Inria, INRAE, CNRS Univ. Côte d'Azur)</p>\n\n\n![](figs/ceratitis_small.png){.absolute top=280 left=200 height=200}\n![](figs/suzu.png){.absolute top=250 right=200 height=200}\n\n\n\n![](figs/logos2.svg){.absolute top=580 left=870 height=85}\n<!-- ![](figs/logos.svg){fig-align=\"center\" height=30} -->\n\n<!-- . . . \n\n![](figs/cresus.png){.absolute top=160 left=900 height=180} -->\n\n\n\n- widespread polyphagous dipteran insects that lay their eggs in fruits\n    - *Ceratitis capitata* : citrus, stone fruits... \n    - *Drosophila suzukii* : berries, cherries...\n![](figs/ceratitis_small.png){.absolute right=250 top=130 height=100}\n![](figs/suzu.png){.absolute right=120 top=130 height=100}\n\n. . .\n\n- after hatching, maggots develop inside fruits, entailing massive damage\n    - make them unfit for consumption\n    - may cause early fruit drop\n    - create entry points for diseases\n\n![](figs/ceratitis_small.png){.absolute left=10 top=450 height=50}\n![](figs/damage/pomelo_down.png){.absolute left=200 top=450 width=250}\n![](figs/damage/pomelo_larvae.png){.absolute left=10 top=520 width=250}\n![](figs/damage/disease.png){.absolute left=340 top=588 width=150}\n\n![](figs/suzu.png){.absolute right=50 top=450 height=52}\n![](figs/damage/cherries.png){.absolute right=150 top=450 width=300}\n![](figs/damage/suzukki_maggot.jpg){.absolute right=50 top=550 width=200}\n\n\n## Fruit flies control\n\n\n\n- control of fruit flies has long relied on chemicals \n    - sustainability and health issues\n    - development of resistant flies\n    - more stringent state regulations (EU)\n\n![](figs/sprayer.jpg){.absolute right=50 top=80 height=200}\n\n. . .\n\n<br><br><br><br>\n\n<!-- ![](figs/sdgs.png){.absolute right=50 top=280 height=200} -->\n\n![](figs/sdg-wheel.png){.absolute right=20 top=370 height=220}\n\n- alternative eco-friendly control means include\n    - crop sanitation, mass trapping\n    - biological control\n    - sterile insect technique (developed worldwide for *C. capitata*, in R&D for *D. suzukii*)\n\n\n\n\n\n\n## Sterile Insect Technique (SIT)\n\n- flood agricultural plots with factory produced sterilized males \n    - prevent matings between *wild male* and *wild females*\n    <!-- - *sterilized males* and *wild females* mates do not produce offspring -->\n\n. . . \n\n![](figs/waldo.png){.absolute left=150 top=190 width=650}\n![](figs/where.svg){.absolute right=120 top=190 height=150}\n\n<p style=\"text-align: center;margin-top: 9.1cm\"> \nSIT is like a football game with so many people on the ground <br>you simply cannot find your teammates ^[Nick Secomb, General Manager of the Fruit Fly Response Program in Australia]\n</p>\n\n\n## Outline\n\n- model SIT in an agricultural context relevant to fruit flies\n\n. . . \n\n- access to reliable estimates of crop damage\n\n. . . \n\n- analyze influence of sterile male introductions on model dynamics and damage levels\n\n. . . \n\n- study if and how sterile male pattern of introduction can be optimized\n\n\n## Fruit flies life cycle\n![](figs/life_cycle0.svg){.absolute left=150 width=750} \n\n. . . \n\n![](figs/life_cycle1.svg){.absolute left=150 width=750}  \n\n. . .\n\n![](figs/life_cycle2.svg){.absolute left=150 width=750}  \n\n. . . \n\n![](figs/life_cycle3.svg){.absolute left=150 width=750}  \n\n. . . \n\n![](figs/life_cycle4.svg){.absolute left=150 width=750}  \n\n## Model diagram \n\n- 4 stages: eggs/larvae $L$, unmated females $V$, males $M$, mated females $F$ ^[based on the model proposed, in a different context, by: Anguelov, Dufourd and Dumont, *App. Math. Mod.*, 2017]\n\n![](figs/shema.svg){.absolute left=150 width=750}  \n\n\n\n\n## Mating model\n\n:::: {.columns}\n\n::: {.column width=\"55%\"}\n- frequency dependent mating probability ^[Anguelov *et alii*, 2017]\n  - \\# males $M$ abundant  \n  females $V$ mated at rate $v_F$\n  - \\# males $M$ limiting  \n  mating proba. $\\frac{\\gamma M}{V}$, $V$ mating rate $\\frac{\\gamma M}{V} v_F$\n:::\n\n::::\n\n![](figs/mating_rate.svg){.absolute left=600 top=50 width=450}\n\n. . . \n\n<p style=\"margin-bottom:1.5cm;\"></p>\n\n\n- overall mating rate per unmated females $V$\n\n$$\nv_F \\min\\left(\\frac{\\gamma M}{V}, 1\\right)\n$$\n\n\n\n## Population dynamics model\n\n$$\n\\left\\{\\begin{array}{l}\n\\dot L = r \\left(1-\\frac{L}{K}\\right)F - v_L L -\\mu_L L\\\\\n\\dot M =  p v_L L - \\mu_M M\\\\\n\\dot V = (1-p)v_L L - v_F \\min\\left(\\frac{\\gamma M}{V}, 1\\right) V -\\mu_F V \\\\\n\\dot F = v_F \\min\\left(\\frac{\\gamma M}{V},1\\right)V - \\mu_F F\n\\end{array}\\right. \n$$\n\n. . . \n\n- in an agricultural context, the insect pest settles in crops at high densities s.t. \n$$\n\\eta_0 = \\frac {r\\,(1-p) v_L v_F}{\\mu_F (\\mu_F + v_F)(\\mu_L + v_L)} > 1\n$$\n\n. . . \n\n- in that case, the positive equilibrium of the saturated submodel is GAS for the full model (Anguelov *et alii*, 2017)\n- thus the $\\min(.)$ necessarily saturates to 1 after some transient times \n\n::: {.notes}\n- in a relevant agricultural context, we are interested in situations where the insect is a pest, that is it as a tendency to settle at high densities in crops\n\n- in such situations, Anguelov and collaborators showed that the equilibrium of the model with the min saturated at 1 is actually GAS for the full model\n\n- in what follows, we will concentrate on this simpler form to study the effects of sterile male introductions\n:::\n\n\n## Reduced model\n\n- in what follows, we therefore concentrate on the simpler form\n\n$$\n\\left\\{\\begin{array}{l}\n\\dot L = r \\left(1-\\frac{L}{K}\\right)F - v_L L -\\mu_L L\\\\\n\\dot M =  p v_L L - \\mu_M M\\\\\n\\dot V = (1-p)v_L L - v_F V -\\mu_F V\\\\\n\\dot F = v_F V - \\mu_F F\n\\end{array}\\right.\n$$\n\n- assuming that the basic reproduction number\n\n$$ \n\\eta_0 = \\frac {r\\,(1-p) v_L v_F}{\\mu_F (\\mu_F + v_F)(\\mu_L + v_L)} > 1\n$$\n\n\n## Model diagram (with sterile males)\n\n- 5th stage: sterile males $M_s$ (= constant for now)\n\n\n![](figs/shema_SIT.svg){.absolute left=150 width=750}\n\n\n\n<p style=\"text-align: center;margin-top: 12.8cm\"> \n$M_S$ divert a part of unmated females $V$ to *mated-with-sterile* females\n</p>\n\n## Model with sterile males\n\n- only a proportion $\\frac{M}{M+M_s}$ of matings yield egg-laying females\n\n$$\n\\left\\{\\begin{array}{l}\n\\dot L = r\\left(1-\\frac{L}{K}\\right)F - v_L L -\\mu_L L\\\\\n\\dot M =  p v_L L - \\mu_M M\\\\\n\\dot V = (1-p)v_L L - v_F V -\\mu_F V\\\\\n\\dot F = v_F \\frac{M}{M+M_S} V - \\mu_F F\n\\end{array}\\right.\n$$\n\n\n\n\n## Analysis: equilibria\n\n- equilibria are solutions of\n\n$$\\small\n\\left\\{\\begin{array}{ll}\nF = \\frac{v_L+\\mu_L}{r\\left(1-\\frac{L}{K}\\right)}L ~~~~~& \\textsf{(i)}\\\\\nM = \\frac{pv_L}{\\mu_M} L & \\textsf{(ii)}\\\\\nV = \\frac{(1-p) v_L}{v_F+\\mu_F} L & \\textsf{(iii)}\\\\\nF = \\frac{v_F}{\\mu_F}\\frac{M}{M+M_s}V & \\textsf{(iv)}\n\\end{array}\\right.\n$$\n\n. . .\n\n- so that (0,0,0,0) is always an equilibrium\n\n- and, using (i), (ii) and (iii) in (iv), other equilibria must verify\n\n$$\n\\frac{v_L+\\mu_L}{r\\left(1-\\frac{L}{K}\\right)} = \\frac{v_F}{\\mu_F}\\frac{\\frac{pv_L}{\\mu_M} L}{\\frac{pv_L}{\\mu_M} L+M_s}\\frac{(1-p) v_L}{v_F+\\mu_F} \n$$\n\n\n## Analysis: equilibria\n\n- rearranging, other equilibria must verify\n\n$$\n1=\\eta_0\\left(1-\\frac{L}{K}\\right)\\frac{\\frac{pv_L}{\\mu_M} L}{\\frac{pv_L}{\\mu_M} L+M_s} \\Leftrightarrow \nM_s = \\frac{pv_L}{\\mu_M} L\\left(\\eta_0 -1 -\\frac{\\eta_0}{K}L\\right)\n$$\n\n. . .\n\n- RHS term is a concave parabola in $L$, with roots: $0$, and: $K\\left(1-\\frac{1}{\\eta_0}\\right)>0$\n\n. . . \n\n\n:::: {.columns}\n\n::: {.column width=\"55%\"}\n- if $M_s$ larger than max of parabola: no equilibrium other than $0$<br><br>\n\n\n- if $M_s$ smaller than max of parabola, there exists two positive equilibria with $0 < L^*_1 < L^*_2 < K$\n:::\n\n::: {.column width=\"45%\"}\n```{julia}\n#| output: true\n\n## parameters\nβ = 3. #6.\nK = 1000.\nv_L = 1/12.8\nμ_L = -log(0.64)/12.8\nm = 0.5\nμ_M = 1/93.6\nv_F = 1/1.5\nμ_F = 1/79.5\nM_S = 2500.\n\nη0 = v_L * v_F * (1-m) * β / (μ_F * (μ_F + v_F)*(μ_L + v_L))\n\nparams_SIT = [β, K, v_L, μ_L, m, μ_M, v_F, μ_F, M_S]\n\nfunction Lparabola(L, params, η0)\n    β, K, v_L, μ_L, m, μ_M, v_F, μ_F, M_S = params\n\n    return m*v_L/μ_M*L*(η0-1-η0*L/K)\nend\n\nLplot = 0:.1:K*(1-1/η0)\n\nLpar = [Lparabola(L, params_SIT, η0) for L in Lplot]\n\nusing LaTeXStrings, Plots\n\nplot(Lplot, [Lpar (0 .*Lplot.+8*10^4) (0 .*Lplot.+5*10^4)],\n        linewidth = 2,\n        title = \"Equilibria computation\\n \",\n        legend = false,\n        xlabel = \"larvae \"*L\"L\",\n        ylabel = \"sterile males \"* L\"M_s\",\n        size = (400, 250),\n        ticks = false)\n\n# max parabola m*v_L/(4*μ_M)*(η0-1)^2\n\n```\n\n:::\n\n::::\n\n## Analysis: stability \n\n- Jacobian matrix is 4D :fearful: \n\n$$\nJ= \\left(\\begin{array}{cccc}\n-\\frac{r}{K}F-\\mu_L-v_L & 0 & 0 & r\\left(1-\\frac{L}{K}\\right)\\\\\np v_L  & -\\mu_M & 0 & 0 \\\\\n(1-p) v_L & 0 & -(v_F+\\mu_F) & 0 \\\\\n0 & v_F\\frac{M_s}{(M+M_s)^2}V & v_F\\frac{M}{(M+M_s)} & -\\mu_F\n\\end{array}\n\\right)\n$$\n\n. . . \n\n- but with non-negative off-diagonal elements at equilibria :thumbsup:\n\n$$\nJ^*= \\left(\\begin{array}{cccc}\n\\bullet & 0 & 0 & +\\\\\n+  & \\bullet & 0 & 0 \\\\\n+ & 0 & \\bullet & 0 \\\\\n0 & + & + & \\bullet\n\\end{array}\n\\right)\n$$\n\n## Analysis: stability \n\n\n- 0 equilibrium is always LAS, thanks to a nice block-triangular structure\n\n$${\nJ^*_0= \\left(\\begin{array}{ccc|c}\n-\\left(\\mu_L+v_L\\right) & 0 & 0 & r\\\\\np v_L  & -\\mu_M & 0 & 0 \\\\\n(1-p) v_L & 0 & -(v_F+\\mu_F) & 0 \\\\\n\\hline\n0 & 0 & 0 & -\\mu_F\n\\end{array}\n\\right)}\n$$\n\n\n. . . \n\n\n\n:::: {.columns}\n\n::: {.column width=\"55%\"}\n\n- for positive equilibria built on $L^*_1$ and $L^*_2$ \n    - strong clues for *fold bifurcation* at ${\\scriptsize M_s = \\overline{M_{s}} = \\frac{p v_L}{4\\mu_M}\\frac{(\\eta_0-1)^2}{\\eta_0}K}$\n    - so that, given 0 is always LAS, $E^*_1$ would be a saddle and $E^*_2$ would be LAS\n:::\n\n::: {.column width=\"45%\"}\n\n```{julia}\n#| output: true\nplot(Lplot, [Lpar (0 .*Lplot.+8*10^4) (0 .*Lplot.+5*10^4)],\n        linewidth = 2,\n        title = \"Equilibria computation\\n \",\n        legend = false,\n        xlabel = \"larvae \"*L\"L\",\n        ylabel = \"sterile males \"* L\"M_s\",\n        size = (400, 250),\n        ticks = false)\n```\n:::\n\n::::\n\n## Analysis: stability of $E^*_i$\n\n- use the special structure of the Jacobian: a Metzler matrix  \n\n$$\nJ=\\left(\n    \\begin{array}{cc}\n    \\ddots & \\geq 0 \\\\\n    \\geq 0 & \\ddots\n    \\end{array}\n\\right)\n$$\n\n. . . \n\n- Bowong's lemma ^[S. Bowong, *PhD Thesis*, 2003]  \n*Let $J$ be a Meztler matrix that can be decomposed into blocks as*\n$$ \nJ=\\left(\\begin{array}{cc}\nA & B\\\\\nC & D \\\\\n\\end{array}\\right)\n$$\n*Then $J$ is stable if and only if $A$ and $D-C A^{-1} B$ are stable Metzler matrices*\n\n. . . \n\n## Analysis: stability of $E^*_i$\n\n- express $J$ in function of $L^*$\n\n$$\\small\nJ= \\left(\\begin{array}{cc|cc}\n\\frac{-\\eta_0(\\mu_L+v_L)\\frac{p v_L}{\\mu_M} L^*}{\\frac{p v_L}{\\mu_M} L^*+M_s} & 0 & 0 & r\\left(1-\\frac{L^*}{K}\\right)\\\\\np v_L  & -\\mu_M & 0 & 0 \\\\\n\\hline\n(1-p) v_L & 0 & -(\\mu_F+v_F) & 0 \\\\\n0 & \\frac{\\eta_0 \\mu_F(\\mu_L+v_L)M_s L^*}{r (\\frac{p v_L}{\\mu_M} L^*+M_s)^2} & \\frac{v_F\\frac{p v_L}{\\mu_M} L^*}{\\frac{p v_L}{\\mu_M} L^*+M_s} & -\\mu_F\n\\end{array}\n\\right)\n$$\n\n- so that\n\n$$\nA = \\left( \\begin{array}{cc}\n\\frac{-\\eta_0(\\mu_L+v_L)\\frac{p v_L}{\\mu_M} L^*}{\\frac{p v_L}{\\mu_M} L^*+M_s} & 0\\\\\np v_L  & -\\mu_M  \n\\end{array}\\right)~~\\textsf{ is Metzler stable}\n$$\n\n- and\n\n$$\\scriptsize \nB= \\left( \\begin{array}{cc}\n0 & r\\left(1-\\frac{L^*}{K}\\right)\\\\\n0  & 0\n\\end{array}\\right),~\nC = \\left( \\begin{array}{cc}\n(1-p) v_L & 0  \\\\\n0 & \\frac{\\eta_0 \\mu_F(\\mu_L+v_L)M_s L^*}{r (\\frac{p v_L}{\\mu_M} L^*+M_s)^2}\n\\end{array}\\right),~\\textsf{and}~\nD=\\left( \\begin{array}{cc}\n-(\\mu_F+v_F) & 0\\\\\n\\frac{v_F\\frac{p v_L}{\\mu_M} L^*}{\\frac{p v_L}{\\mu_M} L^*+M_s} & -\\mu_F\n\\end{array}\\right)\n$$\n\n\n## Stability of $E^*_i$\n\n- further computations show\n$$\\small\nD-CA^{-1} B = \\left(\\begin{array}{cc}\n-(\\mu_F+v_F) & \\frac{\\mu_F(\\mu_F+v_F)\\left(1-\\frac{L^*}{K}\\right)\\left(\\frac{p v_L}{\\mu_M}L^*+M_s\\right)}{v_F \\frac{p v_L}{\\mu_M} L^*}\\\\\n\\frac{v_F\\frac{p v_L}{\\mu_M} L^*}{\\frac{p v_L}{\\mu_M} L^*+M_s} &\n\\mu_F\\left(\\frac{M_S\\left(1-\\frac{L^*}{K}\\right)}{\\frac{p v_L}{\\mu_M}L^*+M_s} - 1\\right)\\\\\n\\end{array}\n\\right){\\normalsize~~\\textsf{is Metzler}}\n$$\n\n. . . \n\n- and \n$$\\small\n\\begin{array}{ll}\n\\det(D-CA^{-1} B) & = -\\mu_F(\\mu_F+v_F)\\left[\\left(1-\\frac{L^*}{K}\\right)\\left(1+\\frac{M_s}{\\frac{p v_L}{\\mu_M}L^*+M_s}\\right)-1\\right]\\\\\n& = -\\frac{\\mu_F(\\mu_F+v_F)}{\\eta_0}\\left(\\eta_0 -1 -\\frac{2 \\eta_0 L^*}{K}\\right)\n\\end{array}\n$$\ngiven that ${\\scriptsize M_s = \\frac{p v_L}{\\mu_M} L^* \\left(\\eta_0 - 1 -\\frac{\\eta_0 L^*}{K}\\right)}$ at equilibrium $E^*_i$\n\n\n\n## Stability of $E^*_i$\n\n\n\n:::: {.columns}\n\n::: {.column width=\"65%\"}\n\n- and this is it: the slope of the parabola at $L^*_i$ is\n$$\n\\frac{d M_s}{dL} = \\frac{p v_L}{\\mu_M}\\left(\\eta_0 - 1 - \\frac{2\\eta_0 L^*_i}{K}\\right)\n$$\nslope sign at $L^*$ sets $\\det(D-CA^{-1}B)$ sign\n:::\n\n::: {.column width=\"35%\"}\n```{julia}\n#| output: true\nplot(Lplot, [Lpar (0 .*Lplot.+5*10^4)],\n        linewidth = 2,\n        title = \"Equilibria computation\\n \",\n        legend = false,\n        xlabel = \"larvae \"*L\"L\",\n        ylabel = \"sterile males \"* L\"M_s\",\n        size = (400, 250),\n        ticks = false)\n```\n:::\n\n::::\n\n. . . \n\n- at $E^*_2$, $\\frac{d M_s}{dL}<0$ which implies: $\\det(D-CA^{-1}B)>0$ and $\\textrm{tr}(D-CA^{-1}B)<0$^[follows from $\\det(D-CA^{-1}B)>0$]\n\n\n  from Bowong's lemma, $J(E^*_2)$ is thus stable and $E^*_2$ is LAS\n\n. . .\n\n- at $E^*_1$, $\\frac{d M_s}{dL}>0$ which implies: $\\det(D-CA^{-1}B)<0$\n\n  from Bowong's lemma, $E^*_1$ is unstable\n\n\n## Bifurcation diagram\n\n```{julia}\n#| output: true\n\nLplot1 = 0:.1:K/2*(1-1/η0)\nLplot2 = K/2*(1-1/η0):.1:K*(1-1/η0)\n\nMs1 = [Lparabola(L, params_SIT, η0) for L in Lplot1]\nMs2 = [Lparabola(L, params_SIT, η0) for L in Lplot2]\n\ncolbifs = palette(:tab10)[3]\ncolbifu = palette(:tab10)[2]\n\nplot([Ms1 Ms2], [Lplot1 Lplot2],\n        linewidth = 3,\n        label = [\"unstable\" \"stable\"],\n        ylabel = \"larvae \"*L\"L^*\",\n        xlabel = \"sterile males \"* L\"M_s\",\n        color = [colbifu colbifs],\n        formatter=Returns(\"\"),\n        margin = .7Plots.cm,\n  \t    size =(1000, 400))\n\nMsplot = 0:100000\n\nplot!(Msplot, (0 .* Msplot),\n        primary = false,\n        linewidth = 3,\n        color = colbifs)\n\n```\n\n- thanks to the cooperativity of the model\n    - when $M_S > \\overline{M_S}$, 0 equilibrium is GAS\n    - when $M<\\overline{M_S}$ trajectories converge to either 0 or $E_2^*$\n\n\n## Numerical experiments\n\n```{julia}\nusing DifferentialEquations, StaticArrays, DataFrames\n\n\nfunction model_SIT(u, params, t)\n    β, K, v_L, μ_L, m, μ_M, v_F, μ_F, M_S = params \t# unpacking parameters\n\n    L = u[1] \t\t\t\t\t\t# unpacking state\n    M = u[2]\n    V = u[3]\n    F = u[4]\n\n    dL = β*(1-L/K)*F - (v_L+μ_L)*L \n    dM = m*v_L*L -μ_M*M \n    dV = (1-m)*v_L*L - v_F*V - μ_F*V\n    dF = v_F*M/(M+M_S)*V - μ_F*F\n  \n    return @SVector [dL, dM, dV, dF]\nend\n\n## initial conditions\nL0 = 110.0 # 0.0\nM0 = 0.001\nV0 = 0.0\nF0 = 0.0 #10.0\n\nstate0 = @SVector [L0, M0, V0, F0]\n\n## time\ntmax = 350.\ntspan = (0.0, tmax) \t# (start, end) as a tuple\nstep = 0.01\n\n## integration\nfunction int_SIT(model_SIT, state0, tspan, params_SIT, step)\n    prob_SIT = ODEProblem(model_SIT, state0, tspan, params_SIT, saveat = step)\n\n    sim_SIT = solve(prob_SIT, abstol=1e-6, reltol=1e-6)\n    sim_SIT = DataFrame(sim_SIT)\n    rename!(sim_SIT, :timestamp => :time, :value1 => :L, :value2 => :M, :value3 => :V, :value4 => :F)\n\n    return sim_SIT\nend\n```\n\n\n```{julia}\n#| output: true\nη0 \n\n```\n\n\n```{julia}\n#| output: true\nsim_SIT = int_SIT(model_SIT, state0, tspan, params_SIT, step)\n\nstate02 = @SVector [700., 0., 0., 0.]\nsim_SIT2 = int_SIT(model_SIT, state02, tspan, params_SIT, step)\n\ncolors = palette(:tab10)[1:4]'\n\nplot(sim_SIT.time, [sim_SIT.L sim_SIT.M sim_SIT.V sim_SIT.F], \n    color = colors,\n    linewidth = 2,\n    title = \"\\n SIT population dynamics\",\n    label = [\"larvae \" * L\"L\" \"males \" * L\"M\" \"unmated females \" * L\"V\" \"mated females \" * L\"F\"],  # latex strings, makrdown latex is off in labels\n    ylabel = \"population densities\",\n    xlabel = \"time\",\n    margin = .5Plots.cm,\n    topmargin = 1Plots.cm)\n\nplot!(sim_SIT2.time, [sim_SIT2.L sim_SIT2.M sim_SIT2.V sim_SIT2.F], \n    color = colors,\n    linewidth = 2,\n    linestyle = :dash,\n    primary = false)\n```\n\n## $\\scriptsize M_s < \\overline{M_S}$ : bi-stability\n\n```{julia}\n#| output: true\n\np1 = plot([sim_SIT.time sim_SIT2.time], [sim_SIT.L sim_SIT2.L], lw=2, ylabel = \"larvae \"*L\"L\", label = [\"persistence\" \"extinction\"], legend = :right)\np3 = plot([sim_SIT.time sim_SIT2.time], [sim_SIT.M sim_SIT2.M], lw=2, ylabel = \"males \"*L\"M\", xlabel = \"time\", legend = false)\np2 = plot([sim_SIT.time sim_SIT2.time], [sim_SIT.V sim_SIT2.V], lw=2, ylabel=\"unmated females \"*L\"V\", legend = false)\np4 = plot([sim_SIT.time sim_SIT2.time], [sim_SIT.F sim_SIT2.F], lw=2, ylabel = \"mated females \"*L\"F\", xlabel = \"time\", legend= false)\n\nplot(p1, p2, p3, p4, layout=(2,2), formatter=Returns(\"\"),    \n    margin = .5Plots.cm)\n```\n\n## $\\scriptsize M_s > \\overline{M_S}$ : 0 is GAS\n\n```{julia}\n#| output: true\n\nM_S2 = 75000.\n\nparams_SIT2 = [β, K, v_L, μ_L, m, μ_M, v_F, μ_F, M_S2]\n\n\nsim_SIT3 = int_SIT(model_SIT, state0, tspan, params_SIT2, step)\nsim_SIT4 = int_SIT(model_SIT, state02, tspan, params_SIT2, step)\n\np1 = plot([sim_SIT3.time sim_SIT4.time], [sim_SIT3.L sim_SIT4.L], lw=2, ylabel = \"larvae \"*L\"L\", label = [\"persistence\" \"extinction\"], legend = :right)\np3 = plot([sim_SIT3.time sim_SIT4.time], [sim_SIT3.M sim_SIT4.M], lw=2, ylabel = \"males \"*L\"M\", xlabel = \"time\", legend = false)\np2 = plot([sim_SIT3.time sim_SIT4.time], [sim_SIT3.V sim_SIT4.V], lw=2, ylabel=\"unmated females \"*L\"V\", legend = false)\np4 = plot([sim_SIT3.time sim_SIT4.time], [sim_SIT3.F sim_SIT4.F], lw=2, ylabel = \"mated females \"*L\"F\", xlabel = \"time\", legend= false)\n\nplot(p1, p2, p3, p4, layout=(2,2), formatter=Returns(\"\"),    \n    margin = .5Plots.cm)\n```\n\n\n## Mated females invade\n\n- 0 is still GAS, but...\n\n```{julia}\n#| output: true\n\nstate03 = @SVector [0, M0, V0, 150]\nstate04 = @SVector [0, M0, V0, 10]\n\ntspanb = (0.0, 4000) \n\nsim_SIT5 = int_SIT(model_SIT, state03, tspanb, params_SIT2, 10*step)\nsim_SIT6 = int_SIT(model_SIT, state04, tspanb, params_SIT2, 10*step)\n\np1 = plot([sim_SIT5.time sim_SIT6.time], [sim_SIT5.L sim_SIT6.L], lw=2, ylabel = \"larvae \"*L\"L\", label = [\"persistence\" \"extinction\"], legend = :right)\np3 = plot([sim_SIT5.time sim_SIT6.time], [sim_SIT5.M sim_SIT6.M], lw=2, ylabel = \"males \"*L\"M\", xlabel = \"time\", legend = false)\np2 = plot([sim_SIT5.time sim_SIT6.time], [sim_SIT5.V sim_SIT6.V], lw=2, ylabel=\"unmated females \"*L\"V\", legend = false)\np4 = plot([sim_SIT5.time sim_SIT6.time], [sim_SIT5.F sim_SIT6.F], lw=2, ylabel = \"mated females \"*L\"F\", xlabel = \"time\", legend= false)\n\nplot(p1, p2, p3, p4, layout=(2,2), formatter=Returns(\"\"),    \n    margin = .5Plots.cm)\n```\n\n\n\n\n## Mated females invade\n\n- but GAS is not always enough\n\n```{julia}\n#| output: true\n\nstate03 = @SVector [0, M0, V0, 150]\nstate04 = @SVector [0, M0, V0, 10]\n\ntspanb = (0.0, 350) \n\nsim_SIT5b = int_SIT(model_SIT, state03, tspanb, params_SIT2, 10*step)\nsim_SIT6 = int_SIT(model_SIT, state04, tspanb, params_SIT2, 10*step)\n\np1 = plot([sim_SIT5b.time sim_SIT6.time], [sim_SIT5b.L sim_SIT6.L], lw=2, ylabel = \"larvae \"*L\"L\", label = [\"persistence\" \"extinction\"], legend = :right)\np3 = plot([sim_SIT5b.time sim_SIT6.time], [sim_SIT5b.M sim_SIT6.M], lw=2, ylabel = \"males \"*L\"M\", xlabel = \"time\", legend = false)\np2 = plot([sim_SIT5b.time sim_SIT6.time], [sim_SIT5b.V sim_SIT6.V], lw=2, ylabel=\"unmated females \"*L\"V\", legend = false)\np4 = plot([sim_SIT5b.time sim_SIT6.time], [sim_SIT5b.F sim_SIT6.F], lw=2, ylabel = \"mated females \"*L\"F\", xlabel = \"time\", legend= false)\n\nplot(p1, p2, p3, p4, layout=(2,2), formatter=Returns(\"\"),    \n    margin = .5Plots.cm)\n```\n\n\n## Larvae vs. population size\n\n\n- total population not a very good proxy for larvae population / crop damage\n\n```{julia}\n#| output: true\n\nscatter([sim_SIT5.L+sim_SIT5.V+sim_SIT5.M+sim_SIT5.F], [sim_SIT5.L], \n        ma=0.5, legend = false,\n        xlabel = \"total population \"*L\"L+V+M+F\",\n        ylabel = \"larvae population \"*L\"L\",\n        margin = .5Plots.cm)\n```\n\n\n## Model with pulsed $M_s$ introductions\n\n- same equations as before, but $M_s$ is dynamic\n\n$$\n\\left\\{\\begin{array}{ll}\n\\dot M_s = -\\mu_M M_s & \\forall t\\in(kT, (k+1)T)\\\\\nM_s(kT^+) = M_s(kT) + \\sigma T\n\\end{array}\\right.\n$$\n\n. . . \n\n- classical trick to compare different introduction regimes for a given introduction rate $\\sigma$ ^[Mailleret & Grognard, 2009]\n\n![](figs/intro_pattern.svg){.absolute left=100 top=380 width=850}\n\n## Numerical experiments: pulses\n\n```{julia}\n#| output: true\nfunction model_SIT_Ms(u, params, t)\n    β, K, v_L, μ_L, m, μ_M, v_F, μ_F, M_S = params \t# unpacking parameters\n\n    L = u[1] \t\t\t\t\t\t# unpacking state\n    M = u[2]\n    V = u[3]\n    F = u[4]\n    Ms = u[5]\n\n    dL = β*(1-L/K)*F - (v_L+μ_L)*L \n    dM = m*v_L*L -μ_M*M \n    dV = (1-m)*v_L*L - v_F*V - μ_F*V\n    dF = v_F*M/(M+Ms)*V - μ_F*F\n    dMs = - μ_M*Ms\n  \n    return @SVector [dL, dM, dV, dF, dMs]\nend\n\n\n## Ms release rate\nα = 18\n\n## release period T\nT = 50.\n\n## initial state\n\n\n## integrate over a T period\nfunction int_SIT_period(model, state0, tspan, params_SIT, step)\n\n    prob_SIT_period = ODEProblem(model, state0, tspan, params_SIT, saveat = step)\n    sim_SIT_period = solve(prob_SIT_period, abstol=1e-6, reltol=1e-6,saveat = step)\n    \n    return sim_SIT_period\nend\n\n## function for simulation of pulsed releases\nfunction int_Ms_pulses(model, state0, params_SIT, step, α, T; early = false)\n\n    store_sim = []\n\n    tspan_period = (0., T)\n    nmax = floor(tmax/T)\n    L0, M0, V0, F0 = state0\n    early || (state0_Ms = @SVector [L0, M0, V0, F0, 0])\n    early && (state0_Ms = @SVector [L0, M0, V0, F0, α*T])\n\n    state0_loop = state0_Ms\n\n    for i in 1:nmax\n        sim_period = int_SIT_period(model, state0_loop, \n                                    tspan_period, params_SIT, step)\n\n        push!(store_sim, sim_period)\n        \n        state0_loop = last(sim_period) + [0, 0, 0, 0, α*T]\n        tspan_period = tspan_period .+ T\n    end\n\n    ## on réunit tout dans une DF\n    sol_pulse = DataFrame(store_sim[1])\n\n    for i in 2:Int(nmax)\n        append!(sol_pulse, DataFrame(store_sim[i]))\n    end\n\n    rename!(sol_pulse, :timestamp => :time, :value1 => :L, :value2 => :M, \n            :value3 => :V, :value4 => :F, :value5 => :Ms)\n\n    return sol_pulse\nend\n\n## simulate for pulsed releases\nsol_pulse = int_Ms_pulses(model_SIT_Ms, state0, params_SIT, step, α, 50)\n\n# graphe\nplot(sol_pulse.time, [sol_pulse.L sol_pulse.M sol_pulse.V sol_pulse.F sol_pulse.Ms], \n    palette = :tab10,\n    linewidth = 2,\n    title = \"\\n SIT population dynamics\",\n    label = [\"larvae \" * L\"L\" \"males \" * L\"M\" \"unmated females \" * L\"V\" \"mated females \" * L\"F\" \"Sterile Males \" * L\"M_s\"],  # latex strings, makrdown latex is off in labels\n    ylabel = \"population densities\",\n    xlabel = \"time\",\n    margin = .5Plots.cm,\n    topmargin = 1Plots.cm )\n\n```\n\n## Numerical experiments (pulses)\n\n- which introduction strategy works best ? (release late)\n\n```{julia}\n#| output: true\n\n\n\n# alpharange = 1:1:800\nalpharange = 1:20:1500\nTrange = 1:3:13\n\nfunction larvaend(model, state0, tspan, params_SIT, step = step, T = T; early = false)\n    maxL = []\n\n    for α in alpharange\n        sol_pulse = int_Ms_pulses(model, state0, params_SIT, step, α, T; early = early)\n\n        maxL = push!(maxL, maximum(sol_pulse[sol_pulse.time .> tmax - T, :L]))\n    end\n\n    return maxL\nend\n\nmaxLT = DataFrame()\n\ni=1 \nfor T in Trange\n    maxL = larvaend(model_SIT_Ms, state04, tspan, params_SIT, step , T; early = false)\n    maxLT[!, \"$i\"] = maxL\n    i+=1\nend\n\nplot(alpharange, [maxLT[:, i] for i in 1:ncol(maxLT)],\n    linewidth = 2,\n    title = \"\\n max. Larvae at end of program\",\n    label = [L\"T=\"*\"$T\" for T in Trange'],  # latex strings, makrdown latex is off in labels\n    ylabel = \"Larvae density\",\n    xlabel = \"introduction rate \"*L\"\\sigma\",\n    margin = .5Plots.cm,\n    topmargin = 1Plots.cm)\n\n# maxLT\n\n```\n\n## Numerical experiments (pulses)\n\n- which introduction strategy works best ? (release early)\n\n```{julia}\n#| output: true\n\n# alpharange = 1:.1:80\nalpharange = 1:20:800\nTrange = 1:3:13\n\nmaxLT2 = DataFrame()\n\ni=1 \nfor T in Trange\n    maxL = larvaend(model_SIT_Ms, state04, tspan, params_SIT, step , T; early = true)\n    maxLT2[!, \"$i\"] = maxL\n    i+=1\nend\n\n\nplot(alpharange, [maxLT2[:, i] for i in 1:ncol(maxLT2)],\n    linewidth = 2,\n    title = \"\\n max. Larvae at end of program\",\n    label = [L\"T=\"*\"$T\" for T in Trange'],  # latex strings, makrdown latex is off in labels\n    ylabel = \"Larvae density\",\n    xlabel = \"introduction rate \"*L\"\\sigma\",\n    margin = .5Plots.cm,\n    topmargin = 1Plots.cm)\n\n```\n\n\n## Conclusion\n\n- SIT rocks\n\n- importance of larvae compartment\n    - dynamics are very different regarding the initial condition \n    - larvae density (damage) not well correlated with total population size\n\n- strategy\n    - same results wrt $T$ if larvae or mated females invade (but much larger release rates are required in that former case)\n    - same results with other proxy of damage as $\\int L(\\tau)d\\tau$\n\n\n. . . \n\n- Do you wonder what happens if *sterile* males are not *that sterile* ?\n\n- Marine will show you more on wednesday morning\n\n## Thank you\n\n\n. . . \n\n![](figs/waldo2.svg){.absolute left=50 top=190 width=850}\n\n![](figs/where.svg){.absolute right=50 top=190 height=150}\n\n. . . \n\n![](figs/waldohere.svg){.absolute left=50 top=190 width=850}\n"},"formats":{"revealjs":{"identifier":{"display-name":"RevealJS","target-format":"revealjs"},"execute":{"fig-width":10,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":"auto","echo":false,"output":false,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"jupyter"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","html-math-method":{"method":"mathjax","url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML-full"},"slide-level":2,"to":"revealjs","from":"markdown+emoji","css":["styles.scss"],"output-file":"topo.html"},"language":{},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.3.191","auto-stretch":true,"jupyter":"julia-1.8","slideNumber":true,"smaller":true,"scrollable":true,"theme":"default","footer":"Sex- and stage-structured SIT model - MPDEE 2023 Marseille","chalkboard":true}}}}